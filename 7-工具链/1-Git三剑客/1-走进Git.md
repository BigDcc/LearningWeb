[TOC]

## 1 Git入门与设置

### 1.1 Git简介

- `Git`的主要作用是在开发过程中利用版本控制的思想管理代码的版本迭代；
- 通常的版本控制工具分为集中式版本控制工具（`SVN`）和分布式版本控制工具（`Git`）,集中式版本控制工具，容易在服务器脱机或者损坏的情况下，出现单点故障，严重时导致数据丢失。而分布时的版本控制工具避免了单点故障出现的严重后果；
- `Linus`利用`C`语言开发了`Git`工具，`Git`已成为当前最著名的版本控制工具，`Git`相关的命令与`Linux`命令兼容；
- `Git`可以对任何类型的文件进行版本控制，但是通常用来管理源代码，也就是纯文本的内容，图片等内容通常只能感知数据大小的变化；
- 通常我们使用`Git`提供的命令行去管理仓库，而非`GUI`程序；
- 通常我们在使用`Git`版本控制的时候，利用集中式的思想，建立一个主仓，而在本地库进行开发，主仓又叫做远程库，在局域网环境下通常使用`GitLab`托管代码，在外网环境下通常使用`GitHub`或者码云进行托管。

![分布式版本控制系统架构](./res/001.png)

> - [Git官方网站](https://git-scm.com)
> - **版本控制**是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统
> - **分布式版本控制系统**把代码仓库完整地镜像下来，包括完整的历史记录，分布在每一个使用节点之上
> - Git 把数据看作是对小型文件系统的一系列快照，实际操作中是在操作快照流，所以他的速度很快

- 命令行
- GUI模式
  - gitk

### 1.2 安装Git与初始配置

#### 1.2.1 安装Git

- 软件包安装
  - 绿色解压安装
  - 包管理工具安装
  - 下载安装包安装
- 源码安装

`Git`支持全平台，不同平台的安装详情可以查看，[Git安装指导](https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%AE%89%E8%A3%85-Git)， 这里介绍在`ubuntu`下如何安装`Git`。

1. 使用`Ubuntu`中的包管理软件`apt`进行安装。

```shell
sudo apt install git-all
```

2. 检验`Git`是否安装成功。

```shell
git --version  # 查看git版本
```





#### 1.2.2 签名设置

签名的初始化和仓库工作树的初始化，是不分前后顺序的。先建立哪一个都可以。但是必须保证这两个都进行了相关操作，再开启我们的git之旅，否则，git操作时会报错。

通常签名有三种作用域范围， 它们的优先级依次升高。

- 系统级（System）
- 系统用户级（Global）
- 本地仓级（Local）

最常使用的设置，就是用户级和本地仓级。

##### 1.2.2.1 系统用户级设置

```shell
# 进行系统用户级配置

git config --global user.name "用户名"
git config --global user.email "邮箱"

# 查看当前用户配置列表

 git config --global --list
 
 # 配置文件存放位置
 
 ~/.gitconfig
```

##### 1.2.2.2 仓库签名设置

```shell
# 进行仓库级设置，由于优先级较高，会覆盖global和System的设置

git config user.name "用户名"
git config user.email "邮箱"

# 查看当前仓库配置列表

git config --list

# 配置文件存放位置

your_project_name/.git/config  # 配置文件存放位置在当前仓库中
```

> 这里值得注意的是，设置的姓名和邮箱地址，会用在git的提交日志中，由于在GitHub上公开仓库时，这里的姓名和邮箱地址也会随着提交日志一同被公开，所以请不要使用不便公开的隐私信息。

#### 1.2.3 获取帮助 

```shell
git help command  # 获得全面的帮助信息
git command -h  # 获得command命令参数的快速参考
```

#### 1.2.4 增强操作性

##### 1.2.4.1 配置命令

`Git`提供了配置工具`git config`，来设置 `Git` 外观和行为，这些设置项通常保存在以下的文件当中：

```shell
# 不同作用域的配置文件存放位置

/etc/gitconfig  # 针对系统
~/.gitconfig  # 针对当前用户
./.git/config  # 针对当前仓库

# 可使用命令快速编辑配置文件

git config -e <作用域名参数>  # 不写作用域名时，默认本地仓库

# 读取配置文件中的属性值 => git config <section>.<key>

git config alias.st # 读取alias章节中的st属性指代的值

# 修改配置文件中的属性值 => git config alias.st 

git config alias.st log # 使用st指代log
```
低级别的配置文件会覆盖高级别的配置文件，既我们常说的就近原则，就像我们前面设置的签名，如果同时设置了用户签名和仓库签名，那git在管理文件的时候优先使用当前仓库的配置文件。

##### 1.2.4.2 配置vim为默认编辑器

`Git`在日常的使用当中会调用编辑器进行一些相关的操作，如提交时编写详细的编辑信息，这时我们可以为它指定一个我们熟悉的编辑器，如下所示（指定vim）

```shell
git config --global core.editor vim
```

`windows`中可以使用`notepad++`来作为默认编辑器

```powershell
git config --global core.editor "'C:/Program Files/Notepad++/notepad++.exe' -multiInst -notabbar -nosession -noPlugin"
```

##### 1.2.4.3 设置别名

跟`linux`中别名相同，可以给`git`也设置别名，简化长命令

```shell
sudo git config --system alias.st status  # 通常给系统级设置方便一点
```

##### 1.2.4.4 提高可读性

在Git命令输出中开启颜色显示，可提高命令行可读性

```shell
git config --global color.ui true  # 关闭使用false
```





### 1.3 初始化Git仓库

通常有两种获取 Git 项目仓库的方式：

1. 将尚未进行版本控制的本地目录转换为 Git 仓库；
2. 从其它服务器 克隆 一个已存在的 Git 仓库；

#### 1.3.1 初始化自己的仓库

将已有项目纳入`Git`管理或者新建一个`Git`项目，需要使用`git init`命令。

```shell
# 1. 初始化一个git项目
git init your_project_name  # 在当前目录下生成一个your_project_name文件夹即生成了一个空的git项目

l$ ls -alh your_project_name  # 查看初始仓的目录结构
total 8.0K
drwxr-xr-x 1 30678 197609 0  2月  4 21:27 ./
drwxr-xr-x 1 30678 197609 0  2月  4 21:27 ../
drwxr-xr-x 1 30678 197609 0  2月  4 21:27 .git/

# 2. 将已有项目纳入git管理

cd your_project_name
git init  # 同样会生成.git文件夹
```

>  `.git`文件，这个文件夹又叫做附属于该仓库的工作树,我们的操作都是基于工作树的。

#### 1.3.2 克隆他人仓库

初始化一个仓库的另一种方式就是克隆一个别人的仓库，克隆操作支持多种协议，它可以将远程仓库的数据全部拉取到本地，包括.git文件夹，这样我们在获取数据的同时，也就获取到了一个Git仓库，以下演示从GitHub上通过https协议获取一个远程仓库。

```shell
git clone https://github.com/BigDcc/learningNotes.git  # 获取名为learningNotes的仓库
```

克隆时也可以为仓库指定名称，语法如下：

```shell
git clone https://github.com/BigDcc/learningNotes.git  demo # 获取名为learningNotes的仓库,并将learningNotes改为demo
```

### 1.3 Git中的概念



git目录就是Git版本库（又叫仓库，repository）

.git版本库所在的目录为/path/to/my/workspace/demo，它被称为工作区





git仓库中文件通常有两种状态，既已跟踪文件和未跟踪文件，而已跟踪文件又可以分为三种状态，如下所示：

- 未跟踪文件
- 已跟踪文件
  - 已提交：已提交表示数据已经安全地保存在本地数据库中
  - 已修改：表示修改了文件，但还没保存到数据库中
  - 已暂存：表示对一个已修改文件的当前版本做了标记，使之包含在下次提交的快照中 

这些状态又分别对应了git的三种区域，如下所示：

![git的结构](./res/01.png)


### 1.6  git基本操作

#### 1.6.1 git status

		整个的命令操作流程是基于Git结构的，工作树和仓库在被操作的过程当中，状态会不断的发生变化，git通过`git status`实时的查看仓库的变化。

通过1.3节知道了Git的生命周期如下：

![git生命周期](./res/13.png)

> **简洁模式**
>
> 使用`git status -s` 命令或 `git status --short` 命令；
>
> ```shell
> $ git status -s
> M README
> MM Rakefile
> A  lib/git.rb
> M  lib/simplegit.rb
> ?? LICENSE.txt
> ```
>
> 新添加的未跟踪文件前面有 `??` 标记，新添加到暂存区中的文件前面有 `A` 标记，修改过的文件前面有 `M` 标记。 输出中有两栏，左栏指明了暂存区的状态，右栏指明了工作区的状态。例如，上面的状态报告显示： `README` 文件在工作区已修改但尚未暂存，而 `lib/simplegit.rb` 文件已修改且已暂存。 `Rakefile` 文件已修，暂存后又作了修改，因此该文件的修改中既有已暂存的部分，又有未暂存的部分。

#### 1.6.2 跟踪文件

- 使用命令 `git add` 开始跟踪一个文件，`git add` 命令使用文件或目录的路径作为参数；如果参数是目录的路径，该命令将递归地跟踪该目录下的所有文件；
- 是个多功能命令：可以用它开始跟踪新文件，或者把已跟踪的文件放到暂存区，还能用于合并时把有冲突的文件标记为已解决状态等；

```git
git add -u
```



#### 1.6.3 暂存文件

运行提交命令 `git commit`：

可以在 `commit` 命令后添加 `-m` 选项，将提交信息与命令放在同一行



 只要在提交的时候，给 `git commit` 加上 `-a` 选项，Git 就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过 `git add` 步骤：



```shell
git commit -m "init project"

# 省略m参数的时候，git会使用默认编辑器打开一个文件，用于记录本次的提交信息，如果不对文件内容进行更改，直接退出，则认为放弃本次提交
git commit
```



##### 在当前工作区搜索内容

```shell
git grep "需要搜索的内容"
```





#### 1.6.4 忽略文件

		一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。 通常都是些自动生成的文件，比如日志文件，或者编译过程中创建的临时文件等。 在这种情况下，我们可以创建一个名为 `.gitignore` 的文件，列出要忽略的文件的模式。

```shell
cat .gitignore

# -------------------------------------------------------

# 忽略所有的 .a 文件
*.a

# 但跟踪所有的 lib.a，即便你在前面忽略了 .a 文件
!lib.a

# 只忽略当前目录下的 TODO 文件，而不忽略 subdir/TODO
/TODO

# 忽略任何目录下名为 build 的文件夹
build/

# 忽略 doc/notes.txt，但不忽略 doc/server/arch.txt
doc/*.txt

# 忽略 doc/ 目录及其所有子目录下的 .pdf 文件
doc/**/*.pdf
```

		文件 `.gitignore` 的格式规范如下：

- 所有空行或者以 `#` 开头的行都会被 Git 忽略。
- 可以使用标准的 glob 模式匹配(shell中的正则)，它会递归地应用在整个工作区中。
- 匹配模式可以以（`/`）开头防止递归。
- 匹配模式可以以（`/`）结尾指定目录。
- 要忽略指定模式以外的文件或目录，可以在模式前加上叹号（`!`）取反。

#### 1.6.5 移除文件

要从 Git 中移除某个文件，就必须要从已跟踪文件清单中移除（确切地说，是从暂存区域移除），然后提交。 可以用 `git rm` 命令完成此项工作，并连带从工作目录中删除指定的文件，这样以后就不会出现在未跟踪文件清单中了。

如果要删除之前修改过或已经放到暂存区的文件，则必须使用强制删除选项 `-f`（译注：即 force 的首字母）。

#### 1.6.6 移动文件

不像其它的 VCS 系统，Git 并不显式跟踪文件移动操作。 如果在 Git 中重命名了某个文件，仓库中存储的元数据并不会体现出这是一次改名操作。 不过 Git 非常聪明，它会推断出究竟发生了什么，至于具体是如何做到的，我们稍后再谈。

既然如此，当你看到 Git 的 `mv` 命令时一定会困惑不已。

#### 1.6.7 git diff

要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 `git diff`：

此命令比较的是工作目录中当前文件和暂存区域快照之间的差异。 也就是修改之后还没有暂存起来的变化内容。

若要查看已暂存的将要添加到下次提交里的内容，可以用 `git diff --staged` 命令。 这条命令将比对已暂存文件与最后一次提交的文件差异

请注意，git diff 本身只显示尚未暂存的改动，而不是自上次提交以来所做的所有改动。 所以有时候你一下子暂存了所有更新过的文件，运行 `git diff` 后却什么也没有，就是这个原因。

像之前说的，暂存 `CONTRIBUTING.md` 后再编辑，可以使用 `git status` 查看已被暂存的修改或未被暂存的修改。 如果我们的环境（终端输出）看起来如下：

然后用 `git diff --cached` 查看已经暂存起来的变化（ `--staged` 和 `--cached` 是同义词）：

## 2 Git基础操作

### 2.1 一个完整的git提交流程

`git add`命令使用文件或目录的路径作为参数；如果参数是目录的路径，该命令将递归地跟踪该目录下的所有文件。主要作用是将未跟踪的文件变为已跟踪文件，并提交缓存区，以及将当前修改的文件提交到缓存区。







#### 文件重命名

```shell
git mv source_file target_file
```

#### 版本历史查看

`git log`命令在不传入任何参数的默认情况下，会按时间先后顺序列出所有的提交，最近的更新排在最上面。这个命令会列出每个提交的 SHA-1 校验和、作者的名字和电子邮件地址、提交时间以及提交说明。

```shell
git log

git log --oneline

git log -n4 # 查看最近的两次

git log -n2 --oneline  # 配合使用

git log --all

git log --all --graph
```



`gitk`图形界面操作

## 3 分支

使用分支意味着你可以把你的工作从开发主线上分离开来，以免影响开发主线。

在创建初始化`Git`仓库的时候，`Git`会给我们默认建立一个分支`master`我们可以把他理解为主分支。一般的分支我们用`feature`为开头来进行命名，`bug`分支我们可以用`fix`开头来命名。所以这里就涉及到了分支如何分， 如何切换，如何合并，如何解决冲突等问题。



## 0 前言